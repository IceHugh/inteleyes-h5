!function(t){function e(i){if(s[i])return s[i].exports;var n=s[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var s={};e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=85)}({44:function(t,e,s){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},85:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(44),n=s.n(i),r=function(){function t(e){n()(this,t),this.canvas=e,this.width=e.width,this.height=e.height,this.ctx=e.getContext("2d"),this.bindEvent()}return t.prototype.setDcmSeriesInfo=function(t,e){this.stopRender(),this.dcmSet=t,this.pointSet=e,this.states={current:0,rotate:0,scale:1,translate:{x:0,y:0},preTranslate:{x:0,y:0},num:t.length,pointVisible:!0,currentPointLocationID:null,loopNumber:0},this.imgList=this.initImgList(),this.points=this.getCurrentDcmPoints(),this.render()},t.prototype.resetStates=function(){this.states.rotate=0,this.states.scale=1,this.states.translate={x:0,y:0},this.states.preTranslate={x:0,y:0}},t.prototype.initImgList=function(){var t=(this.ctx,this.dcmSet),e=this.width,s=this.height;return t.map(function(t){var i=t.imageData,n=new Image(e,s),r=i;return n.src=r,n})},t.prototype.getCurrentDcmPoints=function(){var t=this.pointSet,e=this.dcmSet,s=this.states,i=this.width,n=this.height,r=e[s.current],o=r.rows,a=r.columns;this.currentDcmInfo=r;var c=o/a>i/n?[i,i*a/o]:[n*o/a,n],l=c[0],h=c[1];return this.DcmWidth=l,this.DcmHeight=h,t.filter(function(t){var e=t.imageNo;return parseFloat(e)===r.imageNo}).map(function(t){var e=t.location.split(","),s=e[0],i=e[1];return t.x=+s/r.rows*l,t.y=+i/r.columns*h,t.l=t.x-t.diameter/2,t.r=t.x+t.diameter/2,t.u=t.y-t.diameter/2,t.d=t.y+t.diameter/2,t})},t.prototype.setPointEvent=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.pointClickCallback=t},t.prototype.setPointVisibility=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.states.pointVisible=t},t.prototype.forward=function(t){return!(t>this.states.num-1||t<0)&&(this.states.translate={x:0,y:0},this.states.preTranslate={x:0,y:0},this.states.current=t,this.points=this.getCurrentDcmPoints(),!0)},t.prototype.up=function(){this.forward(this.states.current-1)},t.prototype.down=function(){this.forward(this.states.current+1)},t.prototype.zoomIn=function(){this.states.scale*=1.25},t.prototype.zoomOut=function(){this.states.scale*=.8},t.prototype.reset=function(){this.resetStates()},t.prototype.bindEvent=function(){var t=this,e=this.width,s=this.height,i=this.canvas,n=!1,r=!1,o=0,a=0;i.addEventListener("mousedown",function(t){t.preventDefault(),n=!0,r=!1,o=t.clientX,a=t.clientY}),i.addEventListener("mousemove",function(e){e.preventDefault(),n&&(r=!0,t.states.translate={x:(e.clientX-o)/t.states.scale+t.states.preTranslate.x,y:(e.clientY-a)/t.states.scale+t.states.preTranslate.y})}),i.addEventListener("mouseup",function(e){e.preventDefault(),n&&(n=!1,r=!1,t.states.preTranslate={x:t.states.translate.x,y:t.states.translate.y},r||c(e))});var c=function(i){if(t.pointClickCallback){var n=[i.offsetX-t.states.translate.x*t.states.scale-e*(1-t.states.scale)/2-(e-t.DcmWidth)*t.states.scale/2]/t.states.scale,r=[i.offsetY-t.states.translate.y*t.states.scale-s*(1-t.states.scale)/2-(s-t.DcmHeight)*t.states.scale/2]/t.states.scale,o=t.points.filter(function(t){var e=t.l,s=t.u,i=t.r,o=t.d;return n>e&&n<i&&r>s&&r<o});if(o.length){var a=o[0];t.setCurrentPointNo(a.location),t.pointClickCallback(a)}}}},t.prototype.setCurrentPointNo=function(t){this.getPoint(t)&&(this.states.currentPointLocationID=t)},t.prototype.getPoint=function(t){var e=this.points.filter(function(e){return e.location===t});return e.length?e[0]:null},t.prototype.drawPoints=function(){var t=this,e=this.points;e.length&&e.forEach(function(e){return t.drawPoint(e)})},t.prototype.drawPoint=function(t){var e=this.ctx,s=(this.width,this.height,this.states),i=this.DcmWidth,n=(this.DcmHeight,s.loopNumber),r=s.currentPointLocationID,o=t.diameter,a=t.x,c=t.y,l=t.location,h=r===l,u=o/2,p=a-i/2>0?1:-1;e.save(),e.beginPath(),e.moveTo(a,c),e.lineTo(a+52*p,c),e.strokeStyle="rgba(235,50,35,1)",e.stroke(),e.arc(a,c,u,0,2*Math.PI),e.fillStyle="rgba(235,50,35,0.8)",e.fill(),e.beginPath(),e.arc(a,c,u+n%100/10,0,2*Math.PI),e.strokeStyle="rgba(235,50,35,0.6)",e.stroke(),e.closePath(),e.beginPath(),e.arc(a,c,u+(n+50)%100/10,0,2*Math.PI),e.strokeStyle="rgba(235,50,35,0.6)",e.stroke(),e.closePath(),this.drawLabel(96,32,a+100*p,c,o+"mm",h),e.restore()},t.prototype.drawLabel=function(t,e,s,i,n){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=this.ctx;o.save(),o.beginPath(),o.rect(s-t/2,i-e/2,t,e),o.fillStyle=o.strokeStyle="rgba(235,50,35,1)",r?o.fill():o.stroke(),o.closePath(),o.textAlign="center",o.textBaseline="middle",o.font="20px Arial",o.fillStyle=r?"#fff":"rgba(235,50,35,1)",o.fillText(n,s,i),o.restore()},t.prototype.draw=function(t){var e=this.ctx,s=this.imgList,i=this.width,n=this.height,r=this.DcmWidth,o=this.DcmHeight,a=(this.states,this.pointSet,this.states),c=a.current,l=a.scale,h=a.translate,u=a.pointVisible;e.save(),e.fillRect(0,0,i,n),e.fillStyle="#000",e.translate(i/2,n/2),e.scale(l,l),e.translate(-i/2+h.x+(i-r)/2,-n/2+h.y+(n-o)/2),e.drawImage(s[c],0,0,r,o),u&&this.drawPoints(),e.restore()},t.prototype.stopRender=function(){this.tid&&(window.cancelAnimationFrame(this.tid),this.tid=null)},t.prototype.render=function(){var t=this;!function e(){t.draw(),t.states.loopNumber++,t.tid=window.requestAnimationFrame(e)}()},t}();window.DICOMViewer=r}});